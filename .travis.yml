sudo: required

services:
  - docker

git:
  depth: 2

branches:
  only:
    - master

install:
  - docker build -t banerjs/blog .

script:
  - docker run --rm banerjs/blog run deploy

after_success:
  - docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD" && docker push banerjs/blog
  # TODO: Add in the ability to merge into the production branch if the build is successful
